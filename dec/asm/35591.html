<!DOCTYPE html>
<html>
<head>
<title>Jet Set Willy: Routine at 35591</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Jet Set Willy" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="35563.html">35563</a></span></td>
<td class="up">Up: <a href="../maps/all.html#35591">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="35841.html">35841</a></span></td>
</tr>
</table>
<div class="description">35591: Main loop (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="35245.html">35245</a>. The main entry point is used when resuming the game after it has been paused.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35591"></span>35591</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,39424</td>
<td class="comment-11" rowspan="4">Copy the attribute bytes from <a href="39424.html">39424</a> to the bottom third of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35594"></span>35594</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,23040</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35597"></span>35597</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,256</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35600"></span>35600</td>
<td class="bytes-0"></td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35602"></span>35602</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32990)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current room from <a href="32990.html">32990</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35605"></span>35605</td>
<td class="bytes-0"></td>
<td class="instruction">OUT (254),A</td>
<td class="comment-11" rowspan="1">Restore the border colour</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35607"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="35245.html">35245</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35607"></span>35607</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34257)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a href="34257.html">34257</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35610"></span>35610</td>
<td class="bytes-0"></td>
<td class="instruction">CP 255</td>
<td class="comment-11" rowspan="1">Has Willy landed after falling from too great a height, or collided with a nasty, an arrow, a guardian, or Maria?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35612"></span>35612</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="35841.html">35841</a></td>
<td class="comment-11" rowspan="1">If so, lose a life</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35615"></span>
<div class="comments">
<div class="paragraph">
Now read the keys H, J, K, L and ENTER (which toggle the in-game music).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35615"></span>35615</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,191</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">B</span> for reading keys H-J-K-L-ENTER</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35617"></span>35617</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,34274</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the music flags at <a href="34274.html">34274</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35620"></span>35620</td>
<td class="bytes-0"></td>
<td class="instruction">IN A,(C)</td>
<td class="comment-11" rowspan="1">Read keys H-J-K-L-ENTER; note that if the game has just resumed after being paused, <span class="register">C</span> holds 0 instead of 254, which is a <a href="../reference/bugs.html#thePauseBug">bug</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35622"></span>35622</td>
<td class="bytes-0"></td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="2">Are any of these keys being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35624"></span>35624</td>
<td class="bytes-0"></td>
<td class="instruction">CP 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35626"></span>35626</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="35591.html#35638">35638</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35628"></span>35628</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1">Were any of these keys being pressed the last time we checked?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35630"></span>35630</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="35591.html#35640">35640</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35632"></span>35632</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="3">Set bit 0 (the keypress flag) and flip bit 1 (the in-game music flag) at <a href="34274.html">34274</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35633"></span>35633</td>
<td class="bytes-0"></td>
<td class="instruction">XOR 3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35635"></span>35635</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35636"></span>35636</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="35591.html#35640">35640</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35638"></span>35638</td>
<td class="bytes-0"></td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-11" rowspan="1">Reset bit 0 (the keypress flag) at <a href="34274.html">34274</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35640"></span>35640</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 1,(HL)</td>
<td class="comment-11" rowspan="1">Has the in-game music been switched off?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35642"></span>35642</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="35591.html#35696">35696</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35644"></span>
<div class="comments">
<div class="paragraph">
The next section of code plays a note of the in-game music.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35644"></span>35644</td>
<td class="bytes-0"></td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the inactivity timer at <a href="34272.html">34272</a> (the game does not automatically pause after a period of inactivity if the in-game music is playing)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35645"></span>35645</td>
<td class="bytes-0"></td>
<td class="instruction">LD (34272),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35648"></span>35648</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34273)</td>
<td class="comment-11" rowspan="3">Increment the in-game music note index at <a href="34273.html">34273</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35651"></span>35651</td>
<td class="bytes-0"></td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35652"></span>35652</td>
<td class="bytes-0"></td>
<td class="instruction">LD (34273),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35655"></span>35655</td>
<td class="bytes-0"></td>
<td class="instruction">AND 126</td>
<td class="comment-11" rowspan="6">Point <span class="register">HL</span> at the appropriate entry in the tune data table at <a href="34399.html">34399</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35657"></span>35657</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35658"></span>35658</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35659"></span>35659</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35661"></span>35661</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,34399</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35664"></span>35664</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35665"></span>35665</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34252)</td>
<td class="comment-11" rowspan="1">Pick up the number of lives remaining (0-7) from <a href="34252.html">34252</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35668"></span>35668</td>
<td class="bytes-0"></td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4"><span class="register">A</span>=28-4<span class="register">A</span>; this value adjusts the pitch of the note that is played depending on how many lives are remaining (the more lives remaining, the higher the pitch)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35669"></span>35669</td>
<td class="bytes-0"></td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35670"></span>35670</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 28</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35672"></span>35672</td>
<td class="bytes-0"></td>
<td class="instruction">NEG</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35674"></span>35674</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-11" rowspan="1">Add the entry from the tune data table for the current note</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35675"></span>35675</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Copy this value to <span class="register">D</span> (which determines the pitch of the note)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35676"></span>35676</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32990)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current room from <a href="32990.html">32990</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35679"></span>35679</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,D</td>
<td class="comment-11" rowspan="1">Initialise the pitch delay counter in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35680"></span>35680</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,3</td>
<td class="comment-11" rowspan="1">Initialise the duration delay counters in <span class="register">B</span> (0) and <span class="register">C</span> (3)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35683"></span>35683</td>
<td class="bytes-0"></td>
<td class="instruction">OUT (254),A</td>
<td class="comment-11" rowspan="8">Produce a note of the in-game music</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35685"></span>35685</td>
<td class="bytes-0"></td>
<td class="instruction">DEC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35686"></span>35686</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="35591.html#35691">35691</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35688"></span>35688</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35689"></span>35689</td>
<td class="bytes-0"></td>
<td class="instruction">XOR 24</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35691"></span>35691</td>
<td class="bytes-0"></td>
<td class="instruction">DJNZ <a href="35591.html#35683">35683</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35693"></span>35693</td>
<td class="bytes-0"></td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35694"></span>35694</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="35591.html#35683">35683</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35696"></span>
<div class="comments">
<div class="paragraph">
Here we check the teleport keys.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35696"></span>35696</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,61438</td>
<td class="comment-11" rowspan="2">Read keys 6-7-8-9-0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35699"></span>35699</td>
<td class="bytes-0"></td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35701"></span>35701</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 1,A</td>
<td class="comment-11" rowspan="1">Is '9' (the activator key) being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35703"></span>35703</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="35591.html#35735">35735</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35706"></span>35706</td>
<td class="bytes-0"></td>
<td class="instruction">AND 16</td>
<td class="comment-11" rowspan="3">Keep only bit 4 (corresponding to the '6' key), flip it, and move it into bit 5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35708"></span>35708</td>
<td class="bytes-0"></td>
<td class="instruction">XOR 16</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35710"></span>35710</td>
<td class="bytes-0"></td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35711"></span>35711</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Now bit 5 of <span class="register">D</span> is set if '6' is being pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35712"></span>35712</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="1">Pick up the WRITETYPER key counter from <a href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35715"></span>35715</td>
<td class="bytes-0"></td>
<td class="instruction">CP 10</td>
<td class="comment-11" rowspan="1">Has WRITETYPER been keyed in yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35717"></span>35717</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="35591.html#35735">35735</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35720"></span>35720</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,63486</td>
<td class="comment-11" rowspan="2">Read keys 1-2-3-4-5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35723"></span>35723</td>
<td class="bytes-0"></td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35725"></span>35725</td>
<td class="bytes-0"></td>
<td class="instruction">CPL</td>
<td class="comment-11" rowspan="2">Keep only bits 0-4 and flip them</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35726"></span>35726</td>
<td class="bytes-0"></td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35728"></span>35728</td>
<td class="bytes-0"></td>
<td class="instruction">OR D</td>
<td class="comment-11" rowspan="1">Copy bit 5 of <span class="register">D</span> into <span class="register">A</span>; now <span class="register">A</span> holds the number of the room to teleport to</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35729"></span>35729</td>
<td class="bytes-0"></td>
<td class="instruction">LD (33824),A</td>
<td class="comment-11" rowspan="1">Store the room number at <a href="33824.html">33824</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35732"></span>35732</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="35090.html">35090</a></td>
<td class="comment-11" rowspan="1">Teleport into the room</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35735"></span>
<div class="comments">
<div class="paragraph">
Finally, check the WRITETYPER keys.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35735"></span>35735</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="1">Pick up the WRITETYPER key counter from <a href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35738"></span>35738</td>
<td class="bytes-0"></td>
<td class="instruction">CP 10</td>
<td class="comment-11" rowspan="1">Has WRITETYPER been keyed in yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35740"></span>35740</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If so, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35743"></span>35743</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(33824)</td>
<td class="comment-11" rowspan="1">Pick up the current room number from <a href="33824.html">33824</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35746"></span>35746</td>
<td class="bytes-0"></td>
<td class="instruction">CP 28</td>
<td class="comment-11" rowspan="1">Are we in <a href="56320.html">First Landing</a>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35748"></span>35748</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35751"></span>35751</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34255)</td>
<td class="comment-11" rowspan="1">Pick up Willy's pixel y-coordinate from <a href="34255.html">34255</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35754"></span>35754</td>
<td class="bytes-0"></td>
<td class="instruction">CP 208</td>
<td class="comment-11" rowspan="1">Is Willy on the floor at the bottom of the staircase?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35756"></span>35756</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35759"></span>35759</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="1">Pick up the WRITETYPER key counter (0-9) from <a href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35762"></span>35762</td>
<td class="bytes-0"></td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="5">Point <span class="register">IX</span> at the corresponding entry in the WRITETYPER table at <a href="34277.html#34279">34279</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35763"></span>35763</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35764"></span>35764</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35766"></span>35766</td>
<td class="bytes-0"></td>
<td class="instruction">LD IX,34279</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35770"></span>35770</td>
<td class="bytes-0"></td>
<td class="instruction">ADD IX,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35772"></span>35772</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,64510</td>
<td class="comment-11" rowspan="2">Read keys Q-W-E-R-T</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35775"></span>35775</td>
<td class="bytes-0"></td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35777"></span>35777</td>
<td class="bytes-0"></td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">Keep only bits 0-4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35779"></span>35779</td>
<td class="bytes-0"></td>
<td class="instruction">CP (IX+0)</td>
<td class="comment-11" rowspan="1">Does this match the first byte of the entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35782"></span>35782</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="35591.html#35802">35802</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35784"></span>35784</td>
<td class="bytes-0"></td>
<td class="instruction">CP 31</td>
<td class="comment-11" rowspan="1">Are any of the keys Q-W-E-R-T being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35786"></span>35786</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35789"></span>35789</td>
<td class="bytes-0"></td>
<td class="instruction">CP (IX-2)</td>
<td class="comment-11" rowspan="1">Does the keyboard reading match the first byte of the previous entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35792"></span>35792</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If so, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35795"></span>35795</td>
<td class="bytes-0"></td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the WRITETYPER key counter at <a href="34275.html">34275</a> to 0 (an incorrect key was pressed)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35796"></span>35796</td>
<td class="bytes-0"></td>
<td class="instruction">LD (34275),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35799"></span>35799</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">Jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35802"></span>35802</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,223</td>
<td class="comment-11" rowspan="2">Read keys Y-U-I-O-P</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35804"></span>35804</td>
<td class="bytes-0"></td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35806"></span>35806</td>
<td class="bytes-0"></td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">Keep only bits 0-4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35808"></span>35808</td>
<td class="bytes-0"></td>
<td class="instruction">CP (IX+1)</td>
<td class="comment-11" rowspan="1">Does this match the second byte of the entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35811"></span>35811</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="35591.html#35831">35831</a></td>
<td class="comment-11" rowspan="1">If so, jump to increment the WRITETYPER key counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35813"></span>35813</td>
<td class="bytes-0"></td>
<td class="instruction">CP 31</td>
<td class="comment-11" rowspan="1">Are any of the keys Y-U-I-O-P being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35815"></span>35815</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If not, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35818"></span>35818</td>
<td class="bytes-0"></td>
<td class="instruction">CP (IX-1)</td>
<td class="comment-11" rowspan="1">Does the keyboard reading match the second byte of the previous entry in the WRITETYPER table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35821"></span>35821</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">If so, jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35824"></span>35824</td>
<td class="bytes-0"></td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the WRITETYPER key counter at <a href="34275.html">34275</a> to 0 (an incorrect key was pressed)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35825"></span>35825</td>
<td class="bytes-0"></td>
<td class="instruction">LD (34275),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35828"></span>35828</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">Jump back to the start of the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35831"></span>35831</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(34275)</td>
<td class="comment-11" rowspan="3">Increment the WRITETYPER key counter at <a href="34275.html">34275</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35834"></span>35834</td>
<td class="bytes-0"></td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35835"></span>35835</td>
<td class="bytes-0"></td>
<td class="instruction">LD (34275),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35838"></span>35838</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="35245.html">35245</a></td>
<td class="comment-11" rowspan="1">Jump back to the start of the main loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="35563.html">35563</a></span></td>
<td class="up">Up: <a href="../maps/all.html#35591">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="35841.html">35841</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Jet Set Willy RAM disassembly 20190607</div>
<div class="copyright">&#169; 1984 Software Projects Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/8B07.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>